<!DOCTYPE html>
<html>
<head>
  <title>Google OAuth Config Check</title>
  <style>
    body {
      font-family: monospace;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      background: white;
    }
    .success { border-left: 4px solid #22c55e; }
    .error { border-left: 4px solid #ef4444; }
    .warning { border-left: 4px solid #f59e0b; }
    button {
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #2563eb;
    }
    pre {
      background: #1f2937;
      color: #10b981;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Google OAuth Configuration Checker</h1>

  <div id="results"></div>

  <button onclick="checkConfig()">Run Diagnostic</button>

  <script>
    function log(message, type = 'status', allowHTML = false) {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      if (allowHTML) {
        div.innerHTML = message; // Only for trusted static content
      } else {
        div.textContent = message; // Safe for dynamic content
      }
      document.getElementById('results').appendChild(div);
    }

    function checkConfig() {
      document.getElementById('results').innerHTML = '';

      // Check if .env is loaded
      const clientId = import.meta.env.VITE_GOOGLE_CLIENT_ID;

      if (!clientId) {
        log('‚ùå Error: VITE_GOOGLE_CLIENT_ID not found in .env file', 'error', true);
        log('üí° Solution: Create .env file with: VITE_GOOGLE_CLIENT_ID=your-client-id', 'warning', true);
        return;
      }

      log('‚úÖ Client ID loaded: ' + clientId.substring(0, 20) + '...', 'success');

      // Check client ID format
      if (!clientId.endsWith('.apps.googleusercontent.com')) {
        log('‚ö†Ô∏è Warning: Client ID format looks incorrect', 'warning', true);
        log('Expected format: xxx-xxx.apps.googleusercontent.com', 'warning');
      } else {
        log('‚úÖ Client ID format is correct', 'success');
      }

      // Check current URL
      const currentUrl = window.location.href;
      log('‚ÑπÔ∏è Current URL: ' + currentUrl, 'status');

      if (!currentUrl.includes('localhost:5173')) {
        log('‚ö†Ô∏è Warning: Not running on localhost:5173', 'warning', true);
        log('Make sure http://localhost:5173 is in Authorized JavaScript origins', 'warning');
      } else {
        log('‚úÖ Running on correct port (5173)', 'success');
      }

      log(`
        Next Steps if still getting errors:

        1. Go to OAuth Consent Screen (https://console.cloud.google.com/apis/credentials/consent)
        2. Check Publishing Status:
           - If "Testing" ‚Üí Add your email under Test Users
           - OR click "PUBLISH APP" to make it available to all users

        3. Verify Scopes include:
           - https://www.googleapis.com/auth/spreadsheets

        4. Check OAuth Client (https://console.cloud.google.com/apis/credentials):
           - Authorized JavaScript origins: http://localhost:5173
      `, 'status');

      // Display Client ID safely without HTML injection
      const idDiv = document.createElement('div');
      idDiv.className = 'status';
      const idLabel = document.createElement('strong');
      idLabel.textContent = 'Your Client ID:';
      const idPre = document.createElement('pre');
      idPre.textContent = clientId;
      idDiv.appendChild(idLabel);
      idDiv.appendChild(document.createElement('br'));
      idDiv.appendChild(idPre);
      document.getElementById('results').appendChild(idDiv);
    }
  </script>
</body>
</html>
